<!doctype html>
<html class="no-js h-100" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Admin Laolottery</title>
    <meta name="description"
          content="A high-quality &amp; free Bootstrap admin dashboard template pack that comes with lots of templates and components.">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" id="main-stylesheet" data-version="1.1.0"
          th:href="@{/styles/shards-dashboards.1.1.0.min.css}">
    <link rel="stylesheet" th:href="@{/styles/extras.1.1.0.min.css}">
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- Data Table -->
    <link rel="stylesheet" th:href="@{/styles/datatables/responsive.dataTables.min.css}"/>
    <link rel="stylesheet" th:href="@{/styles/datatables/jquery.dataTables.min.css}"/>

    <!-- Sweet Alert -->
    <link rel="stylesheet" th:href="@{/css/sweetalert2.min.css}"/>

</head>
<body class="h-100">

<div class="container-fluid">
    <div class="row">
        <!-- Main Sidebar -->
        <aside class="main-sidebar col-12 col-md-3 col-lg-2 px-0">
            <div class="main-navbar">
                <nav class="navbar align-items-stretch navbar-light bg-white flex-md-nowrap border-bottom p-0">
                    <a class="navbar-brand w-100 mr-0" href="index.html" style="line-height: 25px;">
                        <div class="d-table m-auto">
                            <!-- <img id="main-logo" class="d-inline-block align-top mr-1" style="max-width: 25px;" src="images/tg-dashboards-logo.svg" alt="Shards Dashboard"> -->
                            <span class="d-none d-md-inline ml-1">Admin Laolottery</span>
                        </div>
                    </a>
                    <a class="toggle-sidebar d-sm-inline d-md-none d-lg-none">
                        <i class="material-icons">&#xE5C4;</i>
                    </a>
                </nav>
            </div>
            <form action="#" class="main-sidebar__search w-100 border-right d-sm-flex d-md-none d-lg-none">
                <div class="input-group input-group-seamless ml-3">
                    <div class="input-group-prepend">
                        <div class="input-group-text">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <input class="navbar-search form-control" type="text" placeholder="Search for something..."
                           aria-label="Search"></div>
            </form>
            <div class="nav-wrapper">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="admin.html">
                            <i class="material-icons">edit</i>
                            <span>บันทึกผลเลขท้าย</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="windows.html">
                            <i class="material-icons">vertical_split</i>
                            <span>ประวัติบันทึกผลเลขท้าย</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " th:href="@{/logout}">
                            <i class="material-icons">logout</i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>
        <!-- End Main Sidebar -->
        <main class="main-content col-lg-10 col-md-9 col-sm-12 p-0 offset-lg-2 offset-md-3">
            <div class="main-navbar sticky-top bg-white">
                <!-- Main Navbar -->
                <nav class="navbar align-items-stretch navbar-light flex-md-nowrap p-0">
                    <form action="#" class="main-navbar__search w-100 d-none d-md-flex d-lg-flex">
                        <div class="input-group input-group-seamless ml-3">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                            <input class="navbar-search form-control" type="text" placeholder="Search for something..."
                                   aria-label="Search"></div>
                    </form>

                    <nav class="nav">
                        <a href="#"
                           class="nav-link nav-link-icon toggle-sidebar d-md-inline d-lg-none text-center border-left"
                           data-toggle="collapse" data-target=".header-navbar" aria-expanded="false"
                           aria-controls="header-navbar">
                            <i class="material-icons">&#xE5D2;</i>
                        </a>
                    </nav>
                </nav>
            </div>
            <!-- / .main-navbar -->
            <div class="main-content-container container-fluid px-4">
                <!-- Page Header -->
                <div class="page-header row no-gutters py-4">
                    <div class="col-12 col-sm-4 text-center text-sm-left mb-0">
                        <span class="text-uppercase page-subtitle">Dashboard</span>
                        <!-- <h3 class="page-title">บันทึกผลรางวัลเลขท้าย</h3> -->
                    </div>
                </div>

                <!-- End Small Stats Blocks -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="m-0">บันทึกผลรางวัลเลขท้าย</h6>
                                <button type="button" class="btn btn-primary" id="addLotteryPrize" data-toggle="modal"
                                        data-target="#formLotteryPrizeModal">Add
                                </button>

                                <!-- Modal -->
                                <div class="modal fade" id="formLotteryPrizeModal" tabindex="-1"
                                     role="dialog" aria-labelledby="formLotteryPrizeLabel"
                                     aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="formLotteryPrizeLabel">Modal title</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <form id="formLotteryPrize" th:object="${formLotteryPrize}">
                                                <div class="modal-body">
                                                    <input type="hidden" th:field="*{id}"/>
                                                    <div class="form-group row">
                                                        <label class="col-form-label col-4"> Draw
                                                            Date</label>
                                                        <div class="col-8">
                                                            <input type="date" class="form-control"
                                                                   th:field="*{drawDate}" required/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-form-label col-4">Five
                                                            Digits Prize</label>
                                                        <div class="col-8">
                                                            <input type="text" class="form-control"
                                                                   th:field="*{fiveDigitsPrize}" minlength="5"
                                                                   maxlength="5" required/>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-form-label col-4">Two
                                                            Digits Prize</label>
                                                        <div class="col-8">
                                                            <input type="text" class="form-control"
                                                                   th:field="*{twoDigitsPrize}" minlength="2"
                                                                   maxlength="2" required/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-dismiss="modal">Cancel
                                                    </button>
                                                    <button type="submit" class="btn btn-primary">Save</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <!-- End Modal -->
                            </div>
                            <div class="card-body pt-0">
                                <table class="display" id="lottery-prizes-table" style="width: 100%">
                                    <thead>
                                    <tr>
                                        <th></th>
                                        <th class="text-center" style="display: none">ID</th>
                                        <th class="text-center">งวดประจำวันที่</th>
                                        <th class="text-center">รางวัลเลขท้าย 5 ตัว</th>
                                        <th class="text-center">รางวัลเลขท้าย 2 ตัว</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="lotteryPrize : ${lotteryPrizes}">
                                        <td th:text="${lotteryPrizeStat.index + 1}"></td>
                                        <td class="text-center" style="display: none" th:text="${lotteryPrize.id}"></td>
                                        <td class="text-center"
                                            th:text="${#dates.format(lotteryPrize.drawDate, 'dd/MM/yyyy')}"></td>
                                        <td class="text-center" th:text="${lotteryPrize.fiveDigitsPrize}"></td>
                                        <td class="text-center" th:text="${lotteryPrize.twoDigitsPrize}"></td>
                                        <td class="text-center">
                                            <a data-toggle="modal" type="button" href="#"
                                               th:attr="onclick=|editLotteryPrize('${lotteryPrize.id}', '${lotteryPrize.drawDate}', '${lotteryPrize.fiveDigitsPrize}', '${lotteryPrize.twoDigitsPrize}')|"
                                               data-target="#formLotteryPrizeModal"
                                               id="editLotteryPrize"> <i class="material-icons">edit</i></a>
                                            <a href="#" type="buttone"
                                               th:attr="onclick=|deleteLotteryPrize('${lotteryPrize.id}')|"
                                            ><i class="material-icons">delete</i></a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script src="https://unpkg.com/shards-ui@latest/dist/js/shards.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sharrre/2.0.1/jquery.sharrre.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.3/dist/sweetalert2.all.min.js"></script>
<!--<script type="text/javascript" th:src="@{/scripts/extras.1.1.0.min.js}"></script>-->
<!--<script type="text/javascript" th:src="@{/scripts/shards-dashboards.1.1.0.min.js}"></script>-->
<!--<script type="text/javascript" th:src="@{/scripts/app/app-blog-overview.1.1.0.js}"></script>-->

<!-- Data Table -->
<script type="text/javascript" th:src="@{/js/datatables/jquery-3.5.1.js}"></script>
<script type="text/javascript" th:src="@{/js/datatables/jquery.dataTables.min.js}"></script>
<script type="text/javascript" th:src="@{/js/datatables/dataTables.responsive.min.js}"></script>

<!-- Sweet Alert -->
<script type="text/javascript" th:src="@{/js/sweetalert2.min.js}"></script>

<script th:inline="javascript">
    var $lotteryPrizes = [[${lotteryPrizes}]];
    var $dataTables;
    $(document).ready(function () {
        $dataTables = $('#lottery-prizes-table').DataTable();

        $('#addLotteryPrize').on('click', function () {
            $('#drawDate').val('');
            $('#fiveDigitsPrize').val('');
            $('#twoDigitsPrize').val('');
        });

        $("body").on('submit', '#formLotteryPrizeModal', function (e) {
            e.preventDefault();
            if ($lotteryPrizes.some($lotteryPrize => $lotteryPrize.drawDate === $('#drawDate').val())) {
                Swal.fire({
                    icon: 'error',
                    title: "มีผลรางวัลประที่ " + $('#drawDate').val() + " แล้ว",
                    showConfirmButton: true
                }).then((result) => {
                    return;
                });
            } else {
                var $form = $('#formLotteryPrize');
                $.ajax({
                    type: 'POST',
                    async: false,
                    dataType: 'text',
                    data: $.param($form.serializeArray()),
                    url: '/admin/lottery-prize/save',
                    success: function (data, textStatus) {
                        Swal.fire({
                            icon: 'success',
                            title: data,
                            showConfirmButton: false,
                            timer: 1500
                        }).then((result) => {
                            location.reload();
                        });
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        Swal.fire({
                            icon: 'error',
                            title: xhr.responseText,
                            showConfirmButton: true
                        }).then((result) => {
                            return;
                        });
                    }
                });
            }
        });
    });

    function editLotteryPrize(id, drawDate, fiveDigitsPrize, twoDigitsPrize) {
        $('#id').val(id);
        $('#drawDate').val(drawDate);
        $('#fiveDigitsPrize').val(fiveDigitsPrize);
        $('#twoDigitsPrize').val(twoDigitsPrize);
    }

    function deleteLotteryPrize(id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    type: 'DELETE',
                    async: false,
                    dataType: 'text',
                    data: {id: id},
                    url: '/admin/lottery-prize/delete',
                    success: function (data, textStatus) {
                        Swal.fire({
                            icon: 'success',
                            title: data,
                            showConfirmButton: false,
                            timer: 1500
                        }).then((result) => {
                            location.reload();
                        });
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        Swal.fire({
                            icon: 'error',
                            title: xhr.responseText,
                            showConfirmButton: true
                        }).then((result) => {
                            return;
                        });
                    }
                });
            }
        })
    }
</script>

</body>
</html>